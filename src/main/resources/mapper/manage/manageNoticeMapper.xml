<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ksinfo.blind.manage.mapper.ManageNoticeMapper">
	<!--[메모] [주의]본 NoticeMapper는 관리자(Manager)만 대상으로 합니다. -->
	<!--[메모] [주의]유저용 NoticeMapper는 "com.ksinfo.blind.common.mapper.NoticeMapper"를 봐주십시오.  -->

	<!--메모 notice_blind_flag 0 : 전체(공지+비공지)출력 / 1:공지확정만 출력. / 2:비공지만 출력.-->
	<select id="getNoticeListForManager" parameterType="java.util.Map"
			resultType="com.ksinfo.blind.manage.vo.NoticeVO">
		SELECT
				notice_id AS noticeId,
		        notice_title AS noticeTitle,
				ntm.notice_type_name AS noticeTypeName,
				um.user_nickname AS userNickname,
				notice_blind_flag AS noticeBlindFlag,
				notice_contents AS noticeContents,

				notice_website_url AS noticeWebsiteUrl,
				post_file_id AS postFileId,
				notice_create_date  AS noticeCreateDate,
				notice_update_date AS noticeUpdateDate

		FROM blind.notice_mgt as nm

		LEFT Join blind.notice_type_mst as ntm
		ON nm.notice_type_code = ntm.notice_type_code

		LEFT Join blind.user_mgt as um
		ON nm.user_id = um.user_id

		WHERE ntm.logical_del_flag = '0'
		<choose>
			<when test="selectedNoticeBlindFlag eq '0' ">
				AND nm.notice_blind_flag = '0'
			</when>
			<when test="selectedNoticeBlindFlag eq '1' ">
				AND nm.notice_blind_flag = '1'
			</when>
		  	<otherwise>
				<!--메모 전체(공지&비공지)모두 출력. -->
			</otherwise>
		</choose>
		ORDER BY notice_id;
	</select>


	<!--
	<select id="getBoardList" resultType="com.ksinfo.blind.manage.vo.ManageBoardVO">
		SELECT board_id AS boardId,
			board_topic_name AS boardTopicName,
			board_order AS boardOrder,
			closed_flag AS closedFlag,
			anonymous_flag AS anonymousFlag
		FROM blind.board_mgt
		WHERE logical_del_flag = '0'
			AND closed_flag = #{closedFlag}
		<if test="anonymousFlag neq '2'">
			AND anonymous_flag = #{anonymousFlag}
		</if>
		ORDER BY board_order;
	</select>

	<select id="getLastOrder" resultType="_int">
		SELECT COUNT(*) FROM blind.board_mgt WHERE logical_del_flag = '0' AND closed_flag = '0';
	</select>
	<select id="createBoard" parameterType="com.ksinfo.blind.manage.dto.BoardCreateDto" resultType="_long"
			statementType="CALLABLE">
		{CALL blind.create_board(
			#{boardTopicName}, #{boardOrder}, #{anonymousFlag}, #{userId}
		)}
	</select>

	<update id="updateBoard" parameterType="com.ksinfo.blind.manage.dto.BoardUpdateDto" statementType="CALLABLE">
		CALL blind.update_board(
			#{boardId}, #{boardTopicName}, #{boardOrder}, #{closedFlag}, #{anonymousFlag}, #{userId}
		);
	</update>
	-->
</mapper>
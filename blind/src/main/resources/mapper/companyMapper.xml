<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ksinfo.blind.manage.mapper.CompanyMapper">
	<select id="getTotalRecordsCount" parameterType="com.ksinfo.blind.manage.vo.CompanySearchVO" resultType="_int">
		SELECT COUNT(*)
		FROM blind.company_mgt
		<if test="searchTarget eq 'businessTypeName'">
			INNER JOIN blind.business_type_mst
				ON company_mgt.business_type_code = business_type_mst.business_type_code
		</if>
		<where>
			<if test="verifyFlag lt 3">
				verify_flag = CAST(#{verifyFlag} AS CHAR)
			</if>
			<if test="closingFlag lt 2">
				AND closing_flag = CAST(#{closingFlag} AS CHAR)
			</if>
			<if test="searchTarget neq ''">
				AND
				<choose>
					<when test="searchTarget eq 'companyName'">company_name</when>
					<when test="searchTarget eq 'businessTypeName'">business_type_name</when>
					<when test="searchTarget eq 'companyAddress'">company_address</when>
					<when test="searchTarget eq 'companyDomain'">company_domain</when>
					<otherwise>company_id</otherwise>
				</choose>
				LIKE '%' || #{searchKeyword} || '%'
			</if>
		</where>
	</select>

	<select id="getCompanyList" parameterType="com.ksinfo.blind.manage.vo.CompanySearchVO" resultType="com.ksinfo.blind.manage.vo.CompanyVO">
		SELECT
			company_mgt.company_id,
			verify_flag,
			closing_flag,
			company_name,
			company_mgt.business_type_code,
			business_type_name,
			company_address,
			TO_CHAR(founding_date, 'YYYY-MM-DD') AS founding_date,
			workers_count,
			company_domain,
			user_nickName,
			TO_CHAR(app_date, 'YYYY-MM-DD') AS app_date
		FROM blind.company_mgt
		INNER JOIN blind.user_mgt
			ON company_mgt.user_id = user_mgt.user_id
		INNER JOIN blind.business_type_mst
			ON company_mgt.business_type_code = business_type_mst.business_type_code
		<where>
			<if test="searchKeyword neq ''">
				<choose>
					<when test="searchTarget eq 'companyName'">company_name</when>
					<when test="searchTarget eq 'businessTypeName'">business_type_name</when>
					<when test="searchTarget eq 'companyAddress'">company_address</when>
					<when test="searchTarget eq 'companyDomain'">company_domain</when>
					<otherwise>company_id</otherwise>
				</choose>
				LIKE '%' || #{searchKeyword} || '%'
			</if>
			<if test="verifyFlag lt 3">
				AND verify_flag = CAST(#{verifyFlag} AS CHAR)
			</if>
			<if test="closingFlag lt 2">
				AND closing_flag = CAST(#{closingFlag} AS CHAR)
			</if>
		</where>
		ORDER BY company_id;
	</select>
</mapper>